{
  "constraints": {
    "licensing": [
      "Do not copy proprietary text; author original summaries."
    ],
    "privacy": [
      "Do not include secrets or personal data in the work record.",
      "If inputs contain sensitive data, redact before writing.",
      "If telemetry is emitted, do not send personal data unless explicitly opted in (POSTHOG_INCLUDE_ACTION=1 for role/action payloads)."
    ],
    "safety": [
      "Use timestamp-based filenames to avoid collisions.",
      "Do not overwrite existing work log files.",
      "Reject context values containing path separators or dot-segments."
    ]
  },
  "conformance": {
    "checklist": [
      "inputs_validated",
      "outputs_listed",
      "u_work_emitted",
      "deterministic_naming",
      "inventory_updated"
    ]
  },
  "dependencies": {
    "skills": [],
    "tools": [
      "write_to_file"
    ]
  },
  "eval": {
    "acceptance_criteria": [
      "Creates a markdown file under runtime/contexts/<context>/telemetry/work/.",
      "The record includes method_description_ref, role_assignment_ref, inputs_digest, outputs, and related_decisions fields.",
      "When agent metadata inputs are provided, the record includes an agent_metadata block with agent_session, agent_model, and agent_type.",
      "When agent metadata inputs are omitted, the record does not include agent_metadata.",
      "The filename is timestamp-based to avoid collisions."
    ],
    "tests": [
      {
        "expected": {
          "work_record_path": "runtime/contexts/Tooling/telemetry/work/work-<timestamp>.md",
          "work_record_path_pattern": "^runtime/contexts/Tooling/telemetry/work/work-\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}-\\\\d{2}-\\\\d{2}-\\\\d{3}Z\\\\.md$"
        },
        "input_fixture": {
          "action": "Validated skill inventory generation.",
          "context": "Tooling",
          "method": "telemetry/log-work",
          "outputs": "design/skills/SKILL_INVENTORY.md",
          "role_assignment": "Archivist"
        },
        "name": "basic-log",
        "notes": "Machine-checkable: match work_record_path_pattern; <timestamp> is ISO-8601 with [:.] normalized to '-'."
      },
      {
        "expected": {
          "work_record_path": "runtime/contexts/Skills/telemetry/work/work-<timestamp>.md",
          "work_record_path_pattern": "^runtime/contexts/Skills/telemetry/work/work-\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}-\\\\d{2}-\\\\d{2}-\\\\d{3}Z\\\\.md$"
        },
        "input_fixture": {
          "action": "Minted Name Card 'Example Concept' (example-concept).",
          "context": "Skills",
          "method": "design/mint-name",
          "outputs": "runtime/contexts/Skills/design/names/example-concept.md",
          "role_assignment": "Archivist"
        },
        "name": "basic-log-2",
        "notes": "Machine-checkable: match work_record_path_pattern; <timestamp> is ISO-8601 with [:.] normalized to '-'."
      },
      {
        "expected": {
          "work_record_path": "runtime/contexts/AgentWorkflow/telemetry/work/work-<timestamp>.md",
          "work_record_path_pattern": "^runtime/contexts/AgentWorkflow/telemetry/work/work-\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}-\\\\d{2}-\\\\d{2}-\\\\d{3}Z\\\\.md$",
          "agent_metadata": {
            "agent_session": "AW-2026-01-18-001",
            "agent_model": "gpt-5.2-codex",
            "agent_type": "strategist"
          }
        },
        "input_fixture": {
          "action": "Recorded agent session metadata for a handoff.",
          "context": "AgentWorkflow",
          "method": "telemetry/log-work",
          "outputs": "runtime/contexts/AgentWorkflow/README.md",
          "role_assignment": "Archivist",
          "agent_session": "AW-2026-01-18-001",
          "agent_model": "gpt-5.2-codex",
          "agent_type": "strategist"
        },
        "name": "log-with-agent-metadata",
        "notes": "Machine-checkable: match work_record_path_pattern; agent_metadata contains the provided session/model/type."
      }
    ]
  },
  "failure_modes": [
    "Missing required inputs (method, role_assignment, context, action).",
    "Failed to create or access runtime/contexts/<context>/telemetry/work.",
    "Failed to write work record file.",
    "Optional telemetry emission failed (non-fatal)."
  ],
  "id": "telemetry/log-work",
  "inputs": [
    {
      "description": "MethodDescription identifier for the work being recorded (typically a Skill id like design/mint-name).",
      "name": "method",
      "required": true,
      "type": "string"
    },
    {
      "description": "RoleAssignment performing the work (string reference).",
      "name": "role_assignment",
      "required": true,
      "type": "string"
    },
    {
      "description": "Bounded context used to resolve the runtime work log directory (must be a safe path segment).",
      "name": "context",
      "required": true,
      "type": "string"
    },
    {
      "description": "Description of the work performed.",
      "name": "action",
      "required": true,
      "type": "string"
    },
    {
      "description": "Optional repo-relative path to the MethodDescription (defaults to design/skills/<method>/skill.json when present).",
      "name": "method_path",
      "required": false,
      "type": "string"
    },
    {
      "description": "Optional semicolon-delimited list of output artifact paths produced by the work.",
      "name": "outputs",
      "required": false,
      "type": "string"
    },
    {
      "description": "Optional semicolon-delimited list of related DRR ids or paths.",
      "name": "decisions",
      "required": false,
      "type": "string"
    },
    {
      "description": "Optional agent session identifier for the work record.",
      "name": "agent_session",
      "required": false,
      "type": "string"
    },
    {
      "description": "Optional agent model identifier for the work record.",
      "name": "agent_model",
      "required": false,
      "type": "string"
    },
    {
      "description": "Optional agent type for the work record (strategist, executor, etc).",
      "name": "agent_type",
      "required": false,
      "type": "string"
    },
    {
      "description": "Optional ISO-8601 timestamp_start override (used for deterministic testing).",
      "name": "timestamp_start",
      "required": false,
      "type": "string"
    }
  ],
  "intent": {
    "goal": "Generate a U.Work record for a specific action.",
    "non_goals": [
      "Does not perform the work; only records it.",
      "Does not upload or sync work logs to external systems.",
      "Does not add details not provided in inputs."
    ]
  },
  "metadata": {
    "authors": [
      "FPF Foundry"
    ],
    "created": "2026-01-12",
    "tags": [
      "telemetry"
    ],
    "updated": "2026-01-18"
  },
  "name": "Log Work",
  "outputs": [
    {
      "description": "Path to the generated U.Work markdown file.",
      "name": "work_record_path",
      "type": "string"
    }
  ],
  "procedure": [
    {
      "instruction": "Validate required inputs: method, role_assignment, context, action (ensure context is a safe path segment).",
      "step_id": "step-validate-inputs"
    },
    {
      "instruction": "Resolve runtime/contexts/<context>/telemetry/work and create it if missing.",
      "step_id": "step-resolve-target"
    },
    {
      "instruction": "Resolve method_description_ref (id + optional path/version enrichment).",
      "step_id": "step-resolve-method"
    },
    {
      "instruction": "Compute inputs_digest from normalized input bindings (excluding timestamps).",
      "step_id": "step-compute-digest"
    },
    {
      "instruction": "Construct the U.Work markdown content using the provided inputs and timestamps.",
      "step_id": "step-build-content"
    },
    {
      "instruction": "Write the U.Work markdown file using a timestamped filename.",
      "step_id": "step-write-file"
    },
    {
      "instruction": "If PostHog is configured, emit a u_work_logged event with safe metadata (include action/role only when POSTHOG_INCLUDE_ACTION=1).",
      "step_id": "step-emit-telemetry"
    }
  ],
  "schema_version": "0.1.0",
  "summary": "Generates a U.Work record for an action (Pattern A.15.1).",
  "version": "0.1.1"
}
