schema_version: "0.1.0"
id: design/record-drr
name: Record DRR
summary: "Records a formal Design-Rationale Record (DRR) for architectural decisions."
intent:
  goal: "Create a DRR markdown file that captures context, decision, and consequences."
  non_goals:
    - "Does not make the decision; only records it."
    - "Does not modify or overwrite existing DRRs."
    - "Does not enforce decision content beyond the DRR structure."
inputs:
  - name: title
    type: string
    description: "Short title of the decision."
    required: true
  - name: context
    type: string
    description: "Problem context for the decision."
    required: true
  - name: decision
    type: string
    description: "Decision statement describing the solution."
    required: true
  - name: work_context
    type: string
    description: "Optional work context used when logging U.Work."
    required: false
outputs:
  - name: drr_path
    type: string
    description: "Path to the generated DRR markdown file in design/decisions/."
procedure:
  - step_id: step-validate-inputs
    instruction: "Validate required inputs: title, context, decision."
  - step_id: step-resolve-target
    instruction: "Resolve the design/decisions/ directory and create it if missing."
  - step_id: step-next-id
    instruction: "Determine the next numeric DRR id based on existing decisions files."
  - step_id: step-format-filename
    instruction: "Format the filename as <NNN>-<kebab-title>.md."
  - step_id: step-build-content
    instruction: "Construct the DRR content with Status, Context, Decision, and Consequences sections."
  - step_id: step-write-file
    instruction: "Write the DRR markdown file to design/decisions/."
  - step_id: step-log-work
    instruction: "If telemetry/log-work is available, log the DRR action with spec E.9."
constraints:
  safety:
    - "Do not overwrite existing DRR files."
    - "Use the next available numeric prefix based on existing files."
  privacy:
    - "Do not include secrets or personal data unless explicitly required."
  licensing:
    - "Do not copy proprietary text; author original rationale."
dependencies:
  tools:
    - list_dir
    - view_file
    - write_to_file
  skills:
    - "telemetry/log-work@^0.1.0"
eval:
  acceptance_criteria:
    - "Creates a DRR markdown file in design/decisions/ with a numeric prefix."
    - "The DRR includes Context, Decision, and Consequences sections."
    - "If telemetry/log-work is present, a U.Work record is attempted."
  tests:
    - name: basic-drr
      input_fixture:
        title: "Adopt SkillSpec v0.1.0"
        context: "We need a structured, machine-validated format for defining skills."
        decision: "Adopt SkillSpec v0.1.0 for all skill definitions and validate in CI."
        work_context: "Skills"
      expected:
        drr_path: "design/decisions/001-adopt-skillspec-v0-1-0.md"
      notes: "Assumes an empty design/decisions directory so the next id is 001."
    - name: basic-drr-2
      input_fixture:
        title: "Separate design and runtime artifacts"
        context: "We need a clear separation between design-time docs and runtime outputs."
        decision: "Keep docs/specs under design/ and generated outputs under runtime/."
        work_context: "Tooling"
      expected:
        drr_path: "design/decisions/002-separate-design-and-runtime-artifacts.md"
      notes: "Assumes a single existing DRR so the next id is 002."
version: "0.1.0"
metadata:
  tags:
    - design
  authors:
    - "FPF Foundry"
  created: "2026-01-12"
  updated: "2026-01-12"
failure_modes:
  - "Missing required inputs (title, context, decision)."
  - "Failed to create or access design/decisions/."
  - "Failed to determine the next DRR id."
  - "Failed to write DRR file."
  - "Optional telemetry logging failed (telemetry/log-work unavailable or errored)."
