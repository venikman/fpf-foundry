trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

steps:
  - checkout: self

  - bash: |
      set -euo pipefail
      curl -fsSL https://bun.sh/install | bash
      echo "##vso[task.prependpath]$HOME/.bun/bin"
      bun --version
    displayName: Install Bun

  - bash: |
      set -euo pipefail
      bun develop/tools/skill/validate.ts --all
    displayName: Validate SkillSpec

  - bash: |
      set -euo pipefail
      bun develop/tools/skill/inventory.ts
      git diff --exit-code design/skills/SKILL_INVENTORY.md
    displayName: Verify inventory generation is deterministic

  - bash: |
      set -euo pipefail
      bun develop/tools/skill/index.ts
    displayName: Build skill index

  - bash: |
      set -euo pipefail
      export MODEL_CMD="bun develop/tools/compile/mock-model.ts"
      bun develop/tools/compile/verify.ts
    displayName: Compile regression (deterministic mock model)

